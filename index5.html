<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OBA Epsilon - Final Fixed</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            black: '#1A1A1A',
                            green: '#004D3B',
                            lime: '#D4F238',
                            gray: '#F8F9FB',
                            surface: '#FFFFFF'
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'float': '0 10px 30px -5px rgba(0, 77, 59, 0.15)',
                        'glow': '0 0 15px rgba(212, 242, 56, 0.4)',
                        'card': '0 2px 10px rgba(0,0,0,0.03)'
                    },
                    animation: {
                        'enter': 'enter 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'scale': 'scale 0.2s ease-out'
                    },
                    keyframes: {
                        enter: {
                            '0%': { opacity: '0', transform: 'translateY(10px) scale(0.98)' },
                            '100%': { opacity: '1', transform: 'translateY(0) scale(1)' },
                        },
                        scale: {
                            '0%': { transform: 'scale(0.95)' },
                            '100%': { transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- LOGIC -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('obaApp', () => ({
                currentView: 'auth', 
                authMode: 'login',
                activeTab: 'home',
                searchQuery: '',
                selectedCategory: 'All', 
                
                // Modals
                showAllReceipts: false, // This toggles the receipt history
                notificationsOpen: false,
                feedbackModalOpen: false,
                productDetailModalOpen: false,
                profileModalOpen: false,
                cardsModalOpen: false,
                
                lang: 'az', 
                
                catKeys: ['All', 'Dairy', 'Meat', 'Food', 'Sweets', 'Drinks', 'Hygiene'],

                user: {
                    name: 'Epsilon',
                    surname: 'User',
                    balance: 1.45, 
                    monthlyEarned: 12.40,
                    rank: 'Silver',
                    phone: '50 555 55 55'
                },

                loginForm: { phone: '50 555 55 55', password: 'password' },
                
                selectedReceipt: null,
                selectedRatingItem: null,
                selectedRatingValue: 0,
                selectedProductDetail: null,
                
                animateBalance: false, 
                toast: { visible: false, message: '', type: 'success' },
                
                feedbackReason: '',
                feedbackComment: '',
                
                t: {
                    az: {
                        welcome: "Xoş Gəldin",
                        cashback: "KEŞBEK",
                        rate_earn: "Rəy Bildir",
                        earn_sub: "Pul qazan",
                        receipts: "Qəbzlər",
                        all: "Hamısı",
                        search: "Məhsul axtar...",
                        top10_title: "Xalqın Seçimi",
                        top10_sub: "Ən yüksək reytinqli məhsullar",
                        settings_personal: "Şəxsi Məlumatlar",
                        settings_cards: "Kartlar & Ödəniş",
                        settings_notif: "Bildirişlər",
                        settings_lang: "Dil Seçimi",
                        logout: "Hesabdan Çıx",
                        new_badge: "YENİ • 2x",
                        rated: "Bitdi",
                        pending: "Gözləyir",
                        save: "Yadda Saxla",
                        cancel: "Ləğv Et",
                        submit: "Göndər",
                        reason: "Problem nədir?",
                        comment: "Əlavə qeydlər...",
                        success_rate: "Balansa əlavə edildi!",
                        feedback_success: "Rəyiniz qeydə alındı",
                        categories: {
                            'Dairy': 'Süd məhsulları',
                            'Meat': 'Ət',
                            'Food': 'Ərzaq',
                            'Sweets': 'Şirniyyat',
                            'Drinks': 'İçkilər',
                            'Hygiene': 'Gigiyena'
                        }
                    },
                    en: {
                        welcome: "Welcome",
                        cashback: "CASHBACK",
                        rate_earn: "Rate & Earn",
                        earn_sub: "Get Cash",
                        receipts: "Receipts",
                        all: "All",
                        search: "Search products...",
                        top10_title: "People's Choice",
                        top10_sub: "Top rated products",
                        settings_personal: "Personal Info",
                        settings_cards: "Cards & Payment",
                        settings_notif: "Notifications",
                        settings_lang: "Language",
                        logout: "Log Out",
                        new_badge: "NEW • 2x",
                        rated: "Rated",
                        pending: "Pending",
                        save: "Save",
                        cancel: "Cancel",
                        submit: "Submit",
                        reason: "What went wrong?",
                        comment: "Additional comments...",
                        success_rate: "Added to balance!",
                        feedback_success: "Feedback submitted",
                        categories: {
                            'Dairy': 'Dairy',
                            'Meat': 'Meat',
                            'Food': 'Food',
                            'Sweets': 'Sweets',
                            'Drinks': 'Drinks',
                            'Hygiene': 'Hygiene'
                        }
                    },
                    ru: {
                        welcome: "Добро пожаловать",
                        cashback: "КЕШБЭК",
                        rate_earn: "Оценить",
                        earn_sub: "Получить деньги",
                        receipts: "Чеки",
                        all: "Все",
                        search: "Поиск продуктов...",
                        top10_title: "Выбор Народа",
                        top10_sub: "Лучшие продукты",
                        settings_personal: "Личные Данные",
                        settings_cards: "Карты и Оплата",
                        settings_notif: "Уведомления",
                        settings_lang: "Язык",
                        logout: "Выйти",
                        new_badge: "НОВОЕ • 2x",
                        rated: "Оценено",
                        pending: "Ждет оценки",
                        save: "Сохранить",
                        cancel: "Отмена",
                        submit: "Отправить",
                        reason: "Что случилось?",
                        comment: "Комментарии...",
                        success_rate: "Добавлено на баланс!",
                        feedback_success: "Отзыв отправлен",
                        categories: {
                            'Dairy': 'Молочные',
                            'Meat': 'Мясо',
                            'Food': 'Еда',
                            'Sweets': 'Сладости',
                            'Drinks': 'Напитки',
                            'Hygiene': 'Гигиена'
                        }
                    }
                },

                get feedbackOptions() {
                    return {
                        az: ["Keyfiyyət / Dad", "Qiymət", "Qablaşdırma", "Xarab olub", "Digər"],
                        en: ["Quality / Taste", "Price", "Packaging", "Expired", "Other"],
                        ru: ["Качество / Вкус", "Цена", "Упаковка", "Испорчено", "Другое"]
                    }[this.lang];
                },

                notifications: [
                    { id: 1, title: 'Cashback!', msg: '+0.05₼ dünənki rəy üçün.', time: '2h ago', type: 'reward' },
                    { id: 2, title: 'New Product', msg: 'Atena Xama artıq rəflərdə.', time: '5h ago', type: 'info' }
                ],

                savedCards: [
                    { id: 1, number: '**** **** **** 3826', type: 'visa', bank: 'Kapital Bank' },
                    { id: 2, number: '**** **** **** 1092', type: 'master', bank: 'ABB' }
                ],

                products: [
                    { id: 1, name: "Pepsi 1L", price: 1.15, type: "global", rateable: false, catKey: "Drinks", rating: 4.8 },
                    { id: 2, name: "Lays Cipsi 140g", price: 2.85, type: "global", rateable: false, catKey: "Sweets", rating: 4.7 },
                    { id: 3, name: "Möcüzə Qarğıdalı yağı 1L", price: 5.79, type: "global", rateable: true, points: 1, catKey: "Food", rating: 4.9, reviews: 120 },
                    { id: 4, name: "OBA PL Kərə yağı 250q", price: 3.49, type: "pl", rateable: true, points: 1, catKey: "Dairy", rating: 4.8, reviews: 342 },
                    { id: 5, name: "Dorna Keks (Kakao)", price: 0.39, type: "pl", rateable: true, points: 1, catKey: "Sweets", rating: 4.2, reviews: 89 },
                    { id: 6, name: "YENİ: Atena Xama 20%", price: 1.59, type: "new", rateable: true, points: 2, catKey: "Dairy", rating: 4.9, reviews: 12 }, 
                    { id: 7, name: "OBA Tualet Kağızı", price: 2.99, type: "low_data", rateable: true, points: 1, catKey: "Hygiene", rating: 3.8, reviews: 45 },
                    { id: 8, name: "Alemshah Düyü 1kq", price: 2.40, type: "pl", rateable: true, points: 1, catKey: "Food", rating: 4.8, reviews: 200 },
                    { id: 9, name: "Tamdad Sosis", price: 4.50, type: "pl", rateable: true, points: 1, catKey: "Meat", rating: 4.6, reviews: 150 },
                    { id: 10, name: "Bizim Tarla Pomidor", price: 1.80, type: "global", rateable: false, catKey: "Food", rating: 4.7 },
                    { id: 11, name: "Nur Çörək", price: 0.65, type: "global", rateable: false, catKey: "Food", rating: 4.5 },
                    { id: 12, name: "OBA Şəkər Tozu", price: 1.35, type: "pl", rateable: true, points: 1, catKey: "Food", rating: 4.4, reviews: 90 },
                    { id: 13, name: "Azerçay Buket", price: 3.20, type: "global", rateable: true, points: 1, catKey: "Drinks", rating: 4.9, reviews: 400 },
                    { id: 14, name: "Colgate", price: 2.50, type: "global", rateable: false, catKey: "Hygiene", rating: 4.3 }
                ],

                receipts: [], 

                init() {
                    this.receipts = [
                        { id: 5012, date: 'Bu gün', time: '14:30', total: '15.45', status: 'pending', items: [3, 4, 6, 11, 1] }, 
                        { id: 4988, date: 'Dünən', time: '19:15', total: '8.20', status: 'pending', items: [5, 2, 1, 11, 12] },
                        { id: 4890, date: '10 Dek', time: '11:00', total: '24.80', status: 'pending', items: [9, 8, 2, 7, 14, 12, 13, 6] },
                        { id: 4812, date: '09 Dek', time: '16:45', total: '5.95', status: 'rated', items: [1, 5, 11, 13] },
                        { id: 4755, date: '08 Dek', time: '09:20', total: '12.50', status: 'rated', items: [4, 5, 11, 1, 14] },
                    ].map(r => ({
                        ...r,
                        items: r.items.map((pid, idx) => {
                            const base = this.products.find(p => p.id === pid);
                            return { 
                                ...base, 
                                uniqueId: `${r.id}_${idx}`, 
                                rated: r.status === 'rated' && base.rateable, 
                                userRating: r.status === 'rated' && base.rateable ? 5 : 0 
                            };
                        })
                    }));
                },

                getText(key) {
                    return this.t[this.lang][key];
                },
                
                getCategoryLabel(key) {
                    if (key === 'All') return this.getText('all');
                    return this.t[this.lang].categories[key];
                },

                get filteredProducts() {
                    return this.products.filter(p => {
                        const matchesCat = this.selectedCategory === 'All' || p.catKey === this.selectedCategory;
                        const matchesSearch = p.name.toLowerCase().includes(this.searchQuery.toLowerCase());
                        return matchesCat && matchesSearch;
                    });
                },

                get top10Products() {
                    return this.products
                        .filter(p => p.rateable)
                        .sort((a, b) => b.rating - a.rating)
                        .slice(0, 10);
                },

                login() {
                    this.currentView = 'app';
                    this.showToast(this.getText('welcome'), 'success');
                },

                setLang(l) {
                    this.lang = l;
                    this.selectedCategory = 'All'; 
                },

                setCategory(key) {
                    this.selectedCategory = key;
                    if(key === 'All') this.searchQuery = ''; 
                },

                openReceipt(bill) {
                    bill.items.sort((a, b) => Number(b.rateable) - Number(a.rateable));
                    this.selectedReceipt = bill;
                },
                
                openProductDetail(product) {
                    this.selectedProductDetail = product;
                    this.productDetailModalOpen = true;
                },

                getCategoryIcon(catKey) {
                    const map = {
                        'Dairy': 'fa-cheese', 'Drinks': 'fa-wine-bottle', 'Food': 'fa-wheat-awn',
                        'Sweets': 'fa-cookie-bite', 'Hygiene': 'fa-pump-soap', 'Meat': 'fa-drumstick-bite'
                    };
                    return map[catKey] || 'fa-basket-shopping';
                },

                getCategoryStyle(catKey) {
                    const map = {
                        'Dairy': 'bg-blue-100 text-blue-700', 'Drinks': 'bg-purple-100 text-purple-700',
                        'Food': 'bg-amber-100 text-amber-700', 'Sweets': 'bg-pink-100 text-pink-700',
                        'Hygiene': 'bg-teal-100 text-teal-700', 'Meat': 'bg-red-100 text-red-700'
                    };
                    return map[catKey] || 'bg-gray-100 text-gray-700';
                },

                logout() {
                    this.currentView = 'auth';
                    this.authMode = 'login';
                },

                rateItem(item, stars) {
                    this.selectedRatingItem = item; 
                    this.selectedRatingValue = stars; 
                    if (stars < 3) {
                        this.feedbackReason = '';
                        this.feedbackComment = '';
                        this.feedbackModalOpen = true;
                    } else {
                        if(stars >= 4) {
                            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                        }
                        this.finalizeRating(item, stars);
                    }
                },

                enableEdit(item) {
                    item.rated = false;
                    this.showToast('Reytinq yenilənir...', 'info');
                },

                submitFeedback() {
                    if (!this.feedbackReason) {
                        return this.showToast(this.getText('reason'), 'error');
                    }
                    this.feedbackModalOpen = false;
                    this.finalizeRating(this.selectedRatingItem, this.selectedRatingValue);
                    this.showToast(this.getText('feedback_success'), 'success');
                },

                finalizeRating(item, stars) {
                    item.rated = true;
                    item.userRating = stars;
                    
                    let points = 1; 
                    if (item.type === 'new') points = 2;
                    
                    const cashValue = points * 0.01; 
                    
                    this.user.balance = parseFloat((this.user.balance + cashValue).toFixed(2));
                    this.user.monthlyEarned = parseFloat((this.user.monthlyEarned + cashValue).toFixed(2));
                    
                    this.animateBalance = true;
                    setTimeout(() => this.animateBalance = false, 500);
                    
                    const rateableItems = this.selectedReceipt.items.filter(i => i.rateable);
                    if (rateableItems.every(i => i.rated)) {
                        this.selectedReceipt.status = 'rated';
                    }
                    
                    let msg = `+${cashValue.toFixed(2)}₼`;
                    if(item.type === 'new') msg += " (2x Bonus!)";
                    this.showToast(msg, 'success');
                },

                showToast(msg, type) {
                    this.toast.message = msg;
                    this.toast.type = type;
                    this.toast.visible = true;
                    setTimeout(() => { this.toast.visible = false }, 2000);
                }
            }))
        })
    </script>

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <style>
        body { background-color: #F8F9FB; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .squircle { border-radius: 24px; }
        
        .new-product-glow {
            box-shadow: 0 0 15px rgba(212, 242, 56, 0.4);
            border: 1px solid #D4F238;
        }
    </style>
</head>
<body class="font-sans text-brand-black antialiased selection:bg-brand-green selection:text-white">

    <div id="app" x-data="obaApp()" class="w-full min-h-screen relative max-w-md mx-auto bg-[#F8F9FB] shadow-2xl overflow-hidden">

        <!-- AUTH SCREEN -->
        <div x-show="currentView === 'auth'" x-transition class="absolute inset-0 z-50 bg-white flex flex-col justify-between p-8">
            <div class="mt-20">
                <div class="w-16 h-16 bg-brand-green rounded-2xl flex items-center justify-center text-white text-2xl font-black mb-6 shadow-lg shadow-brand-green/30">OBA</div>
                <h1 class="text-4xl font-extrabold tracking-tight text-gray-900 mb-2">Xoş<br>Gəldiniz.</h1>
                <p class="text-gray-400 font-medium">Qənaətin yeni ünvanı.</p>
            </div>
            
            <div class="w-full space-y-4 mb-10">
                <div class="space-y-3">
                    <input type="tel" x-model="loginForm.phone" class="w-full bg-gray-50 border-0 rounded-2xl px-5 py-4 text-gray-900 font-medium placeholder-gray-400 focus:ring-2 focus:ring-brand-green/20 transition-all" placeholder="Mobil Nömrə">
                    <input type="password" x-model="loginForm.password" class="w-full bg-gray-50 border-0 rounded-2xl px-5 py-4 text-gray-900 font-medium placeholder-gray-400 focus:ring-2 focus:ring-brand-green/20 transition-all" placeholder="Şifrə">
                </div>
                <button @click="login()" class="w-full bg-brand-green text-white font-bold py-4 rounded-2xl shadow-xl shadow-brand-green/20 active:scale-95 transition-transform flex justify-between items-center px-6">
                    <span>Daxil Ol</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- MAIN APP -->
        <div x-show="currentView === 'app'" x-transition.opacity class="min-h-screen flex flex-col">
            
            <!-- Header -->
            <header class="sticky top-0 z-40 bg-[#F8F9FB]/95 backdrop-blur-md px-6 pt-12 pb-4 flex justify-between items-center border-b border-gray-200/50">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-brand-green font-bold shadow-sm border border-gray-100">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <p class="text-xs text-gray-400 font-semibold uppercase tracking-wide" x-text="getText('welcome')"></p>
                        <h2 class="text-lg font-bold text-gray-900" x-text="user.name"></h2>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <!-- Notification Button -->
                    <button @click="notificationsOpen = true" class="w-10 h-10 bg-white rounded-full flex items-center justify-center border border-gray-100 shadow-sm relative active:scale-95 transition-transform cursor-pointer">
                        <i class="fas fa-bell text-gray-400"></i>
                        <div class="absolute top-2.5 right-3 w-2 h-2 bg-brand-lime rounded-full border border-white"></div>
                    </button>
                </div>
            </header>

            <main class="flex-1 px-6 pb-32 space-y-6 pt-4">

                <!-- HOME TAB -->
                <div x-show="activeTab === 'home'" class="space-y-6 animate-enter">
                    
                    <!-- Main Wallet Card -->
                    <div class="relative w-full aspect-[1.7] bg-brand-green rounded-[32px] p-6 text-white shadow-float overflow-hidden flex flex-col justify-between group">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl -mr-16 -mt-16"></div>
                        <div class="absolute bottom-0 left-0 w-40 h-40 bg-brand-lime opacity-10 rounded-full blur-2xl -ml-10 -mb-10"></div>
                        
                        <div class="relative z-10 flex justify-between items-start">
                            <div>
                                <p class="text-white/60 text-xs font-medium tracking-wide mb-1" x-text="getText('cashback')"></p>
                                <h3 class="text-4xl font-bold tracking-tight flex items-baseline gap-1" :class="{'animate-pulse text-brand-lime': animateBalance}">
                                    <span x-text="user.balance.toFixed(2)"></span> <span class="text-xl font-medium text-white/80">₼</span>
                                </h3>
                            </div>
                            <div class="bg-white/10 backdrop-blur-md px-3 py-1 rounded-full border border-white/10">
                                <span class="text-[10px] font-bold text-brand-lime uppercase tracking-wider"><i class="fas fa-bolt mr-1"></i> Aktiv</span>
                            </div>
                        </div>

                        <div class="relative z-10 flex justify-between items-end">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-qrcode text-2xl opacity-80"></i>
                                <div class="text-xs font-mono text-white/70 tracking-widest">**** 3826</div>
                            </div>
                            
                        </div>
                    </div>

                    <!-- Problem Solved Widget -->
                    <div class="bg-white rounded-3xl p-5 shadow-soft border border-gray-50 flex items-start space-x-4">
                        <div class="w-12 h-12 rounded-2xl bg-green-50 flex items-center justify-center text-green-600 shrink-0">
                            <i class="fas fa-check-circle text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <h4 class="font-bold text-gray-900 text-sm">Problemi Həll Etdik</h4>
                                <span class="text-[10px] bg-gray-100 text-gray-500 font-bold px-2 py-1 rounded-full">Yeni</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1 leading-relaxed">
                                <span class="font-bold text-gray-800">OBA Kərə Yağı</span> qablaşdırması rəylərinizə əsasən dəyişdirildi.
                            </p>
                        </div>
                    </div>

                    <!-- Widgets Grid -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-5 rounded-3xl shadow-soft border border-gray-50 flex flex-col justify-between">
                            <div class="flex justify-between items-start">
                                <div class="w-10 h-10 bg-brand-lime/20 rounded-xl flex items-center justify-center text-brand-green">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <span class="text-[10px] text-green-600 font-bold bg-green-50 px-2 py-1 rounded-full">+12%</span>
                            </div>
                            <div class="mt-4">
                                <p class="text-xs text-gray-400 font-bold uppercase">Aylıq Qazanc</p>
                                <h4 class="text-2xl font-extrabold text-gray-900" x-text="user.monthlyEarned + '₼'"></h4>
                            </div>
                        </div>
                        
                        <div class="bg-brand-black p-5 rounded-3xl shadow-float text-white flex flex-col justify-between relative overflow-hidden cursor-pointer group" @click="activeTab = 'products'">
                            <div class="absolute top-0 right-0 w-24 h-24 bg-brand-lime rounded-full blur-[40px] opacity-20 -mr-8 -mt-8 group-hover:opacity-30 transition-opacity"></div>
                            <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center text-white mb-2">
                                <i class="fas fa-star"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg leading-tight" x-text="getText('rate_earn')"></h4>
                                <p class="text-[10px] text-brand-lime mt-1 font-bold"><span x-text="getText('earn_sub')"></span> <i class="fas fa-arrow-right ml-1"></i></p>
                            </div>
                        </div>
                    </div>

                    <!-- Receipt List -->
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-gray-900" x-text="getText('receipts')"></h3>
                            <button @click="showAllReceipts = true" class="text-xs font-bold text-brand-green bg-green-50 px-3 py-1 rounded-full" x-text="getText('all')"></button>
                        </div>
                        <div class="space-y-3">
                            <template x-for="bill in receipts.slice(0, 3)" :key="bill.id">
                                <div @click="openReceipt(bill)" class="bg-white p-4 rounded-2xl shadow-card border border-gray-50 flex justify-between items-center cursor-pointer active:scale-[0.98] transition-transform">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-12 h-12 rounded-2xl bg-gray-50 flex flex-col items-center justify-center text-gray-400 border border-gray-100">
                                            <span class="text-[10px] font-bold uppercase">DEC</span>
                                            <span class="text-sm font-bold text-gray-800">12</span>
                                        </div>
                                        <div>
                                            <p class="font-bold text-gray-900 text-sm" x-text="'Alış #' + bill.id"></p>
                                            <p class="text-xs text-gray-400 mt-0.5" x-text="bill.items.length + ' məhsul • ' + bill.time"></p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-gray-900" x-text="bill.total + '₼'"></p>
                                        <span class="text-[10px] font-bold" :class="bill.status === 'rated' ? 'text-green-600 bg-green-50 px-2 py-0.5 rounded-md' : 'text-orange-500 bg-orange-50 px-2 py-0.5 rounded-md'" x-text="getText(bill.status)"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- PRODUCTS TAB -->
                <div x-show="activeTab === 'products'" class="space-y-6 animate-enter">
                    <div class="sticky top-28 z-30 bg-[#F8F9FB] pb-2">
                        <div class="relative shadow-sm mb-4">
                            <input type="text" :placeholder="getText('search')" x-model="searchQuery" class="w-full bg-white border-0 rounded-2xl pl-12 pr-4 py-4 text-sm font-medium text-gray-800 placeholder-gray-400 shadow-soft outline-none focus:ring-2 focus:ring-brand-green/10">
                            <i class="fas fa-search absolute left-5 top-4.5 text-gray-300 text-lg"></i>
                        </div>
                        
                        <!-- CATEGORY BUTTONS -->
                        <div class="flex space-x-2 overflow-x-auto hide-scroll pb-2 pl-1 relative z-50">
                            <template x-for="key in catKeys" :key="key">
                                <button @click="setCategory(key)" 
                                        :class="selectedCategory === key ? 'bg-brand-black text-white shadow-lg' : 'bg-white text-gray-500 shadow-sm'"
                                        class="px-5 py-2.5 rounded-xl text-xs font-bold whitespace-nowrap transition-all active:scale-95">
                                    <span x-text="getCategoryLabel(key)"></span>
                                </button>
                            </template>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <template x-for="product in filteredProducts" :key="product.id">
                            <div class="bg-white p-4 rounded-3xl shadow-card border border-gray-50 flex items-center justify-between group">
                                <div class="flex items-center space-x-4">
                                    <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-xl squircle" :class="getCategoryStyle(product.catKey)">
                                        <i class="fas" :class="getCategoryIcon(product.catKey)"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-900 text-sm" x-text="product.name"></h4>
                                        <div class="flex items-center space-x-2 mt-1">
                                            <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wide" x-text="getCategoryName(product.catKey)"></span>
                                            <template x-if="product.type === 'new'">
                                                <span class="text-[9px] bg-brand-lime text-black px-2 py-0.5 rounded font-bold">YENİ</span>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-gray-900" x-text="product.price + '₼'"></p>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- TOP 10 TAB -->
                <div x-show="activeTab === 'top10'" class="space-y-6 animate-enter">
                    <div class="text-center py-4">
                        <h2 class="text-2xl font-extrabold text-gray-900" x-text="getText('top10_title')"></h2>
                        <p class="text-sm text-gray-400 font-medium" x-text="getText('top10_sub')"></p>
                    </div>

                    <div class="space-y-3">
                        <template x-for="(product, index) in top10Products" :key="product.id">
                            <div @click="openProductDetail(product)" class="bg-white p-4 rounded-3xl shadow-card border border-gray-50 flex items-center relative overflow-hidden cursor-pointer active:scale-[0.98] transition-transform">
                                <div class="w-8 font-black text-lg italic text-gray-200" x-text="index + 1"></div>
                                <div class="w-12 h-12 rounded-xl flex items-center justify-center mr-4" :class="getCategoryStyle(product.catKey)">
                                    <i class="fas" :class="getCategoryIcon(product.catKey)"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-900 text-sm" x-text="product.name"></h4>
                                    <div class="flex items-center space-x-1 mt-1 text-oba-gold text-xs">
                                        <i class="fas fa-star text-yellow-400"></i>
                                        <span class="font-bold text-gray-700 ml-1" x-text="product.rating"></span>
                                        <span class="text-gray-300 text-[10px] ml-1" x-text="'(' + (product.reviews || 0) + ')'"></span>
                                    </div>
                                </div>
                                <template x-if="index < 3">
                                    <div class="absolute -right-4 -top-4 w-12 h-12 bg-brand-lime rotate-45 flex items-end justify-center pb-1 pl-2">
                                        <i class="fas fa-trophy text-[10px] -rotate-45"></i>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- SETTINGS TAB -->
                <div x-show="activeTab === 'settings'" class="space-y-6 animate-enter">
                    <div class="text-center py-6">
                        <div class="w-24 h-24 bg-brand-green rounded-full mx-auto flex items-center justify-center text-4xl text-white font-bold mb-4 shadow-xl border-4 border-white">
                            E
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900"><span x-text="user.name"></span> <span x-text="user.surname"></span></h2>
                        <div class="inline-flex items-center px-3 py-1 bg-gray-100 rounded-full mt-1">
                            <i class="fas fa-crown text-xs text-gray-500 mr-2"></i>
                            <span class="text-xs font-bold text-gray-600 uppercase">Silver Member</span>
                        </div>
                    </div>

                    <div class="bg-white rounded-3xl shadow-soft border border-gray-50 overflow-hidden divide-y divide-gray-50">
                        <div @click="profileModalOpen = true" class="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center"><i class="fas fa-user-pen"></i></div>
                                <span class="font-bold text-sm text-gray-700" x-text="getText('settings_personal')"></span>
                            </div>
                            <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
                        </div>
                        <div @click="cardsModalOpen = true" class="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-xl bg-green-50 text-green-600 flex items-center justify-center"><i class="fas fa-wallet"></i></div>
                                <span class="font-bold text-sm text-gray-700" x-text="getText('settings_cards')"></span>
                            </div>
                            <i class="fas fa-chevron-right text-gray-300 text-xs"></i>
                        </div>
                         <div class="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-xl bg-purple-50 text-purple-600 flex items-center justify-center"><i class="fas fa-bell"></i></div>
                                <span class="font-bold text-sm text-gray-700" x-text="getText('settings_notif')"></span>
                            </div>
                            <div class="w-10 h-6 bg-brand-green rounded-full relative">
                                <div class="w-4 h-4 bg-white rounded-full absolute top-1 right-1"></div>
                            </div>
                        </div>
                         <div class="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-xl bg-gray-100 text-gray-600 flex items-center justify-center"><i class="fas fa-globe"></i></div>
                                <span class="font-bold text-sm text-gray-700" x-text="getText('settings_lang')"></span>
                            </div>
                            <div class="flex space-x-1">
                                <button @click.stop="setLang('az')" class="text-[10px] font-bold px-2 py-1 rounded" :class="lang==='az' ? 'bg-brand-green text-white' : 'bg-gray-100 text-gray-400'">AZ</button>
                                <button @click.stop="setLang('en')" class="text-[10px] font-bold px-2 py-1 rounded" :class="lang==='en' ? 'bg-brand-green text-white' : 'bg-gray-100 text-gray-400'">EN</button>
                                <button @click.stop="setLang('ru')" class="text-[10px] font-bold px-2 py-1 rounded" :class="lang==='ru' ? 'bg-brand-green text-white' : 'bg-gray-100 text-gray-400'">RU</button>
                            </div>
                        </div>
                    </div>

                    <button @click="logout()" class="w-full bg-white border border-red-100 text-red-500 font-bold py-4 rounded-2xl hover:bg-red-50 transition-colors shadow-sm" x-text="getText('logout')"></button>
                </div>

            </main>

            <!-- NAVIGATION -->
            <nav class="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-brand-black text-white rounded-full px-6 py-4 shadow-2xl shadow-brand-black/30 z-50 flex items-center space-x-8">
                <button @click="activeTab = 'home'" :class="activeTab === 'home' ? 'text-brand-lime' : 'text-white/50'" class="transition-colors"><i class="fas fa-home text-xl"></i></button>
                <button @click="activeTab = 'products'" :class="activeTab === 'products' ? 'text-brand-lime' : 'text-white/50'" class="transition-colors"><i class="fas fa-search text-xl"></i></button>
                <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center -mt-10 border-[6px] border-[#F8F9FB] shadow-xl text-brand-black cursor-pointer active:scale-95 transition-transform">
                    <i class="fas fa-qrcode text-2xl"></i>
                </div>
                <button @click="activeTab = 'top10'" :class="activeTab === 'top10' ? 'text-brand-lime' : 'text-white/50'" class="transition-colors"><i class="fas fa-star text-xl"></i></button>
                <button @click="activeTab = 'settings'" :class="activeTab === 'settings' ? 'text-brand-lime' : 'text-white/50'" class="transition-colors"><i class="fas fa-user text-xl"></i></button>
            </nav>
        </div>

        <!-- ================= MODALS ================= -->

        <!-- RECEIPT HISTORY MODAL (ADDED BACK) -->
        <div x-show="showAllReceipts" class="fixed inset-0 z-[60] flex flex-col bg-[#F8F9FB] animate-enter">
            <div class="px-6 pt-12 pb-4 flex items-center justify-between bg-white/80 backdrop-blur-md z-10 sticky top-0">
                <h2 class="text-2xl font-bold text-gray-900" x-text="getText('receipts')"></h2>
                <button @click="showAllReceipts = false" class="w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-gray-500"><i class="fas fa-times"></i></button>
            </div>
            <div class="flex-1 overflow-y-auto px-6 pb-10 space-y-4 pt-4">
                <template x-for="bill in receipts" :key="bill.id">
                    <div @click="openReceipt(bill)" class="bg-white p-4 rounded-2xl shadow-card border border-gray-50 flex justify-between items-center cursor-pointer active:scale-[0.98] transition-transform">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 rounded-2xl bg-gray-50 flex flex-col items-center justify-center text-gray-400 border border-gray-100">
                                <span class="text-[10px] font-bold uppercase">DEC</span>
                                <span class="text-sm font-bold text-gray-800">12</span>
                            </div>
                            <div>
                                <p class="font-bold text-gray-900 text-sm" x-text="'Alış #' + bill.id"></p>
                                <p class="text-xs text-gray-400 mt-0.5" x-text="bill.items.length + ' məhsul • ' + bill.time"></p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-gray-900" x-text="bill.total + '₼'"></p>
                            <span class="text-[10px] font-bold" :class="bill.status === 'rated' ? 'text-green-600 bg-green-50 px-2 py-0.5 rounded-md' : 'text-orange-500 bg-orange-50 px-2 py-0.5 rounded-md'" x-text="getText(bill.status)"></span>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- NOTIFICATION MODAL -->
        <div x-show="notificationsOpen" class="fixed inset-0 z-[60] flex justify-end">
            <div class="absolute inset-0 bg-brand-black/20 backdrop-blur-sm" @click="notificationsOpen = false"></div>
            <div class="w-3/4 max-w-sm bg-white h-full relative z-10 p-6 flex flex-col shadow-2xl transition-transform duration-300" x-transition:enter="translate-x-full" x-transition:enter-end="translate-x-0">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-xl font-bold text-gray-900" x-text="getText('settings_notif')"></h3>
                    <button @click="notificationsOpen = false"><i class="fas fa-times text-gray-400"></i></button>
                </div>
                <div class="space-y-4">
                    <template x-for="notif in notifications">
                        <div class="bg-gray-50 p-4 rounded-2xl flex gap-4">
                            <div class="w-2 h-2 mt-2 rounded-full shrink-0" :class="notif.type === 'reward' ? 'bg-brand-lime' : 'bg-blue-500'"></div>
                            <div>
                                <h4 class="font-bold text-sm text-gray-900" x-text="notif.title"></h4>
                                <p class="text-xs text-gray-500 mt-1" x-text="notif.msg"></p>
                                <p class="text-[10px] text-gray-300 mt-2" x-text="notif.time"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- PRODUCT DETAIL MODAL -->
        <div x-show="productDetailModalOpen" class="fixed inset-0 z-[70] flex items-end sm:items-center sm:justify-center p-4">
            <div class="absolute inset-0 bg-brand-black/50 backdrop-blur-sm" @click="productDetailModalOpen = false"></div>
            <div class="bg-white w-full max-w-sm rounded-[32px] p-6 relative z-10 animate-enter max-h-[85vh] overflow-y-auto">
                <template x-if="selectedProductDetail">
                    <div>
                        <div class="flex items-start space-x-4 mb-6">
                             <div class="w-20 h-20 rounded-2xl flex items-center justify-center text-3xl squircle" :class="getCategoryStyle(selectedProductDetail.catKey)">
                                <i class="fas" :class="getCategoryIcon(selectedProductDetail.catKey)"></i>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-900 leading-tight" x-text="selectedProductDetail.name"></h2>
                                <p class="text-gray-400 text-sm mt-1" x-text="getCategoryName(selectedProductDetail.catKey)"></p>
                                <div class="flex items-center mt-2 text-yellow-500 font-bold">
                                    <span x-text="selectedProductDetail.rating"></span> <i class="fas fa-star text-xs ml-1"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Rating Chart -->
                        <div class="bg-gray-50 p-4 rounded-2xl mb-6">
                            <h4 class="text-xs font-bold text-gray-400 uppercase mb-3">Reytinq Statistikası</h4>
                            <div class="flex items-end space-x-2 h-24 pb-2 border-b border-gray-200">
                                <div class="flex-1 bg-brand-green rounded-t opacity-90 h-[80%] relative group"><div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-black text-white text-[9px] px-1 py-0.5 rounded opacity-0 group-hover:opacity-100">80%</div></div>
                                <div class="flex-1 bg-brand-green rounded-t opacity-60 h-[60%]"></div>
                                <div class="flex-1 bg-brand-green rounded-t opacity-30 h-[20%]"></div>
                                <div class="flex-1 bg-gray-300 rounded-t h-[5%]"></div>
                                <div class="flex-1 bg-gray-300 rounded-t h-[2%]"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-400 pt-2 font-mono font-bold">
                                <span>5</span><span>4</span><span>3</span><span>2</span><span>1</span>
                            </div>
                        </div>

                        <h3 class="font-bold text-gray-900 mb-3">Son Rəylər</h3>
                        <div class="space-y-3">
                            <div class="bg-gray-50 p-3 rounded-xl border border-gray-100">
                                <div class="flex justify-between mb-1">
                                    <span class="font-bold text-xs text-gray-900">Ayşən M.</span>
                                    <div class="text-[10px] text-yellow-500 flex"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                                </div>
                                <p class="text-xs text-gray-600">Çox dadlıdır, həmişə alıram.</p>
                            </div>
                             <div class="bg-gray-50 p-3 rounded-xl border border-gray-100">
                                <div class="flex justify-between mb-1">
                                    <span class="font-bold text-xs text-gray-900">Kənan V.</span>
                                    <div class="text-[10px] text-yellow-500 flex"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                                </div>
                                <p class="text-xs text-gray-600">Qiyməti münasibdir.</p>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- RECEIPT MODAL WITH EDIT & NEW PRODUCT DESIGN -->
        <div x-show="selectedReceipt" class="fixed inset-0 z-[70] flex items-end sm:items-center sm:justify-center p-4">
            <div @click="selectedReceipt = null" x-show="selectedReceipt" x-transition.opacity class="absolute inset-0 bg-brand-black/60 backdrop-blur-sm"></div>
            
            <div x-show="selectedReceipt" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="translate-y-full opacity-0" x-transition:enter-end="translate-y-0 opacity-100" class="w-full max-w-sm bg-white rounded-[32px] overflow-hidden shadow-2xl relative z-10 max-h-[85vh] flex flex-col">
                <div class="bg-gray-50 p-6 border-b border-dashed border-gray-200">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-2xl font-extrabold text-gray-900" x-text="selectedReceipt ? selectedReceipt.total + '₼' : ''"></h3>
                            <p class="text-sm text-gray-400 font-medium mt-1" x-text="selectedReceipt ? '#' + selectedReceipt.id : ''"></p>
                        </div>
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-gray-400 cursor-pointer hover:bg-red-50 hover:text-red-500 transition-colors" @click="selectedReceipt = null"><i class="fas fa-times"></i></div>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto p-4 space-y-3">
                    <template x-if="selectedReceipt">
                        <template x-for="(item, index) in selectedReceipt.items" :key="item.uniqueId">
                            
                            <!-- ITEM CARD -->
                            <div class="relative p-3 rounded-2xl border transition-all duration-300" 
                                :class="[
                                    item.type === 'new' ? 'border-brand-lime bg-gradient-to-r from-white to-green-50 shadow-glow' : 'border-gray-100 bg-white shadow-sm',
                                    !item.rateable ? 'opacity-60 bg-gray-50' : ''
                                ]">
                                
                                <div class="flex items-center space-x-3 relative z-10">
                                    <div class="w-12 h-12 rounded-xl flex items-center justify-center text-sm shrink-0" :class="getCategoryStyle(item.catKey)">
                                        <i class="fas" :class="getCategoryIcon(item.catKey)"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-2 mb-0.5">
                                            <p class="font-bold text-gray-900 text-sm truncate" x-text="item.name"></p>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <p class="text-xs text-gray-400 font-medium" x-text="item.price + '₼'"></p>
                                            <template x-if="item.type === 'new'">
                                                <div class="flex items-center px-1.5 py-0.5 rounded bg-brand-black/90 backdrop-blur">
                                                    <i class="fas fa-bolt text-[8px] text-brand-lime mr-1 animate-pulse"></i>
                                                    <span class="text-[9px] font-bold text-white tracking-wide" x-text="getText('new_badge')"></span>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </div>

                                <!-- Rating Section -->
                                <template x-if="item.rateable">
                                    <div class="mt-3 flex items-center justify-between border-t border-gray-100 pt-2">
                                        <div class="flex items-center">
                                            <template x-for="i in 5">
                                                <button 
                                                    @click="!item.rated || item.isEditing ? rateItem(item, i) : null" 
                                                    class="text-xl px-0.5 transition-all active:scale-90" 
                                                    :class="i <= item.userRating ? 'text-brand-lime drop-shadow-sm' : 'text-gray-200'">
                                                    <i class="fas fa-star"></i>
                                                </button>
                                            </template>
                                        </div>

                                        <!-- EDIT BUTTON -->
                                        <template x-if="item.rated">
                                            <button @click="enableEdit(item)" class="text-[10px] font-bold text-gray-400 hover:text-brand-green flex items-center px-2 py-1 rounded-md hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-pencil-alt mr-1"></i> Düzəlt
                                            </button>
                                        </template>
                                        <template x-if="!item.rated">
                                            <span class="text-[10px] text-brand-green font-bold bg-green-50 px-2 py-1 rounded">+0.01₼</span>
                                        </template>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </template>
                </div>
            </div>
        </div>

        <!-- PROFILE EDIT MODAL -->
        <div x-show="profileModalOpen" class="fixed inset-0 z-[70] flex items-center justify-center p-6">
            <div class="absolute inset-0 bg-brand-black/60 backdrop-blur-sm" @click="profileModalOpen = false"></div>
            <div class="bg-white w-full max-w-sm rounded-[32px] p-6 relative z-10 animate-enter">
                <h3 class="text-xl font-bold mb-4" x-text="getText('settings_personal')"></h3>
                <div class="space-y-3">
                    <input type="text" x-model="user.name" class="w-full bg-gray-50 border-0 rounded-xl p-3 text-sm font-bold">
                    <input type="text" x-model="user.surname" class="w-full bg-gray-50 border-0 rounded-xl p-3 text-sm font-bold">
                    <input type="text" x-model="user.phone" class="w-full bg-gray-50 border-0 rounded-xl p-3 text-sm font-bold">
                </div>
                <div class="flex space-x-3 mt-6">
                    <button @click="profileModalOpen = false" class="flex-1 bg-gray-100 text-gray-500 font-bold py-3 rounded-xl" x-text="getText('cancel')"></button>
                    <button @click="profileModalOpen = false; showToast('Məlumatlar yeniləndi', 'success')" class="flex-1 bg-brand-green text-white font-bold py-3 rounded-xl" x-text="getText('save')"></button>
                </div>
            </div>
        </div>

        <!-- CARDS MODAL -->
        <div x-show="cardsModalOpen" class="fixed inset-0 z-[70] flex items-center justify-center p-6">
            <div class="absolute inset-0 bg-brand-black/60 backdrop-blur-sm" @click="cardsModalOpen = false"></div>
            <div class="bg-white w-full max-w-sm rounded-[32px] p-6 relative z-10 animate-enter">
                <h3 class="text-xl font-bold mb-4" x-text="getText('settings_cards')"></h3>
                <div class="space-y-3">
                    <template x-for="card in savedCards">
                        <div class="p-4 border border-gray-100 rounded-2xl flex justify-between items-center bg-gray-50">
                            <div class="flex items-center space-x-3">
                                <i class="fab fa-cc-visa text-2xl text-blue-900" x-show="card.type === 'visa'"></i>
                                <i class="fab fa-cc-mastercard text-2xl text-red-500" x-show="card.type === 'master'"></i>
                                <div>
                                    <p class="font-bold text-sm" x-text="card.bank"></p>
                                    <p class="text-xs text-gray-400" x-text="card.number"></p>
                                </div>
                            </div>
                        </div>
                    </template>
                    <div class="p-4 border border-dashed border-gray-300 rounded-2xl flex justify-center items-center text-gray-400 cursor-pointer hover:bg-gray-50">
                        <i class="fas fa-plus mr-2"></i> <span class="text-sm font-bold">Kart Əlavə Et</span>
                    </div>
                </div>
                <button @click="cardsModalOpen = false" class="mt-6 w-full bg-brand-black text-white font-bold py-3 rounded-xl" x-text="getText('save')"></button>
            </div>
        </div>

        <!-- FEEDBACK MODAL -->
        <div x-show="feedbackModalOpen" class="fixed inset-0 z-[80] flex items-end justify-center">
            <div class="absolute inset-0 bg-brand-black/50 backdrop-blur-sm" @click="feedbackModalOpen = false"></div>
            <div class="bg-white w-full max-w-md rounded-t-[32px] p-8 relative z-10 animate-enter shadow-2xl">
                <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-6"></div>
                <h3 class="text-xl font-extrabold text-gray-900 mb-2" x-text="getText('reason')"></h3>
                <div class="flex flex-wrap gap-2 mb-6">
                    <template x-for="option in feedbackOptions" :key="option">
                        <button @click="feedbackReason = option" class="px-4 py-2.5 rounded-xl text-xs font-bold transition-all border-2" :class="feedbackReason === option ? 'bg-brand-black text-white border-brand-black' : 'bg-white text-gray-500 border-gray-100 hover:border-gray-200'"><span x-text="option"></span></button>
                    </template>
                </div>
                <textarea x-model="feedbackComment" class="w-full bg-gray-50 border-0 rounded-2xl p-4 text-sm font-medium placeholder-gray-400 focus:ring-2 focus:ring-brand-green/20 mb-6" rows="3" :placeholder="getText('comment')"></textarea>
                <button @click="submitFeedback()" class="w-full bg-brand-green text-white font-bold py-4 rounded-2xl shadow-xl shadow-brand-green/20 active:scale-95 transition-transform" x-text="getText('submit')"></button>
            </div>
        </div>

        <!-- TOAST -->
        <div x-show="toast.visible" x-transition class="fixed top-6 left-1/2 transform -translate-x-1/2 bg-brand-black/90 backdrop-blur-md text-white px-6 py-3 rounded-full shadow-2xl flex items-center space-x-3 z-[100]">
            <i class="fas fa-check-circle text-brand-lime"></i><span class="text-sm font-bold" x-text="toast.message"></span>
        </div>

    </div>
</body>
</html>
